---
category: Vue.js
topic: Immutability
difficulty: Hard
options:
  - id: 1
    option: Because reactive should have been used instead of ref.
  - id: 2
    option: Because structuredClone is not supported in Vue.js.
  - id: 3
    option: Reactive state in Vue 3 is often wrapped in a Proxy object, but the structuredClone algorithm does not support Proxy objects as cloneable types.
  - id: 4
    option: Because structuredClone does not work with objeccts with nested properties.
correctOptionId: 3
referenceLink: https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm#supported_types
---

::question{:type="questionType"}
The code below uses structuredClone to create a deep copy of the user object in an attempt to avoid mutating the object indirectly. But why does the Vue.js compiler throw the error below?

<br />

```js
const user = ref({ name: "john doe", location: { country: "Nigeria" } });
const userCopy = structuredClone(user.value);
```

<br />

<div style="background-color: #292218; color: #E6A23D; padding: 10px 15px;border-radius: 3px">
Failed to execute 'structuredClone' on 'Window': Object could not be cloned.
</div>

::

::explanation{:type="explanationType"}

**Explanation: Reactive state in Vue 3 is often wrapped in a Proxy object, but the structuredClone algorithm does not support Proxy objects as cloneable types.**

<br />

The error can be fixed by calling toRaw to unwrap to the underlying plain value so it can be cloned safely.

<br />

```js
<script setup>
import { ref,  toRaw } from 'vue'

const user = ref({ name: 'john doe', location: { country: 'Nigeria'} })
const userCopy = structuredClone(toRaw(user.value))
</script>
```

::
